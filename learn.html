<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å–®å­—å¡å­¸ç¿’ | Vocabulary Cards</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        game: ['"Fredoka"', 'sans-serif'],
                    },
                    colors: {
                        primary: '#10b981', // Emerald 500
                        secondary: '#3b82f6', // Blue 500
                        bg: '#f0fdf4',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f0fdf4; }
        .vocab-card {
            transition: all 0.2s;
            cursor: pointer;
            border-bottom: 3px solid #d1d5db;
        }
        .vocab-card:active {
            transform: translateY(2px);
            border-bottom-width: 1px;
            box-shadow: none !important;
        }
        .vocab-card:hover {
            box-shadow: 0 4px 10px -2px rgba(0, 0, 0, 0.1);
            border-color: #10b981;
        }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* V69 Category Button Styles */
        .cat-btn.active {
             background-color: #10b981 !important;
             color: white !important;
             border-color: #059669 !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans text-gray-800">

    <header class="bg-white shadow-sm sticky top-0 z-20">
        <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-3xl">ğŸ“–</span>
                <h1 class="text-xl font-bold tracking-wide text-gray-800">å–®å­—åœ–é‘‘</h1>
            </div>
            <a href="index.html" class="text-gray-400 hover:text-primary transition p-2">
                <i class="fas fa-home text-xl"></i>
            </a>
        </div>
    </header>

    <main class="flex-grow p-4 max-w-5xl mx-auto w-full flex flex-col">
        
        <div id="screen-grade" class="flex-grow w-full flex flex-col justify-center items-center">
            <div class="bg-white rounded-3xl shadow-xl p-6 text-center border-4 border-white w-full max-w-md">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Step 1: é¸æ“‡å¹´ç´š</h2>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="selectGrade(1)" class="py-3 bg-blue-100 text-blue-600 font-bold rounded-xl hover:bg-blue-200 transition">Grade 1</button>
                    <button onclick="selectGrade(2)" class="py-3 bg-blue-100 text-blue-600 font-bold rounded-xl hover:bg-blue-200 transition">Grade 2</button>
                    <button onclick="selectGrade(3)" class="py-3 bg-green-100 text-green-600 font-bold rounded-xl hover:bg-green-200 transition">Grade 3</button>
                    <button onclick="selectGrade(4)" class="py-3 bg-green-100 text-green-600 font-bold rounded-xl hover:bg-green-200 transition">Grade 4</button>
                    <button onclick="selectGrade(5)" class="py-3 bg-purple-100 text-purple-600 font-bold rounded-xl hover:bg-purple-200 transition">Grade 5</button>
                    <button onclick="selectGrade(6)" class="py-3 bg-purple-100 text-purple-600 font-bold rounded-xl hover:bg-purple-200 transition">Grade 6</button>
                </div>
            </div>
        </div>

        <div id="screen-cards" class="hidden flex-grow w-full flex-col">
            
            <div class="flex justify-between items-center mb-3">
                 <button onclick="showGradeSelect()" class="text-gray-500 hover:text-secondary text-sm"><i class="fas fa-arrow-left mr-1"></i> é‡é¸å¹´ç´š</button>
                 <span id="grade-info" class="text-secondary font-bold">Grade 3</span>
            </div>

            <div id="category-bar" class="flex gap-2 overflow-x-auto scrollbar-hide flex-shrink-0 mb-4 pb-1">
                 </div>

            <div id="error-msg" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 text-center">
                <strong class="font-bold">âš ï¸ è®€å–ä¸åˆ° data.js</strong>
                <p class="text-sm mt-1">è«‹ç¢ºèª data.js æª”æ¡ˆæ˜¯å¦å­˜åœ¨æ–¼åŒä¸€ç›®éŒ„ä¸‹ã€‚</p>
            </div>

            <div id="cards-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 flex-grow overflow-y-auto pb-6">
                 </div>

            <div class="text-center mt-4 animate-bounce flex-shrink-0">
                <span class="inline-block bg-yellow-100 text-yellow-700 px-4 py-2 rounded-full text-sm font-bold shadow-sm border border-yellow-200">
                    ğŸ‘‡ é»æ“Šå¡ç‰‡è½è½çœ‹æ€éº¼å”¸ï¼
                </span>
                <a href="game.html" class="block mt-3 text-primary hover:text-secondary text-sm underline font-bold">
                    å®Œæˆé ç¿’ï¼Œé–‹å§‹æŒ‘æˆ°ï¼
                </a>
            </div>

        </div>

    </main>

    <script src="data.js"></script>

    <script>
        // è¨­å®šåˆ†é¡å°æ‡‰è¡¨ (å¿…é ˆèˆ‡ game.js ç›¸åŒ)
        const CAT_CONFIG = {
            'animal': { icon: 'ğŸ¦', cn: 'å‹•ç‰©', en: 'Animals', color: 'green' },
            'food':   { icon: 'ğŸ', cn: 'é£Ÿç‰©', en: 'Food', color: 'red' },
            'fruit':  { icon: 'ğŸŒ', cn: 'æ°´æœ', en: 'Fruit', color: 'orange' },
            'color':  { icon: 'ğŸ¨', cn: 'é¡è‰²', en: 'Color', color: 'purple' },
            'body':   { icon: 'ğŸ‘€', cn: 'èº«é«”', en: 'Body', color: 'yellow' },
            'school': { icon: 'ğŸ’', cn: 'å­¸æ ¡', en: 'School', color: 'blue' },
            'people': { icon: 'ğŸ‘¶', cn: 'äººç‰©', en: 'People', color: 'pink' },
            'nature': { icon: 'ğŸŒ³', cn: 'è‡ªç„¶', en: 'Nature', color: 'emerald' },
            'action': { icon: 'ğŸƒ', cn: 'å‹•ä½œ', en: 'Action', color: 'indigo' },
            'number': { icon: 'ğŸ”¢', cn: 'æ•¸å­—', en: 'Number', color: 'cyan' },
            'default': { icon: 'ğŸ“¦', cn: 'å…¶ä»–', en: 'Other', color: 'gray' }
        };

        let currentGrade = 3; // é è¨­å¹´ç´š
        let currentCategory = 'ALL';

        // åˆå§‹åŒ–
        window.onload = function() {
            if (typeof window.VOCAB_LIST === 'undefined' || !Array.isArray(window.VOCAB_LIST)) {
                document.getElementById('error-msg').classList.remove('hidden');
                return;
            }
            // é è¨­é¡¯ç¤º Grade 3
            selectGrade(3);
        };

        // Step 1: é¸æ“‡å¹´ç´š
        function selectGrade(grade) {
            currentGrade = grade;
            
            // æ‰¾å‡ºè©²å¹´ç´šæœ‰å“ªäº›åˆ†é¡
            const gradeWords = window.VOCAB_LIST.filter(w => w.grade === currentGrade);
            const categories = [...new Set(gradeWords.map(w => w.cat))].sort();

            if (categories.length === 0) {
                 alert(`Grade ${grade} ç›®å‰æ²’æœ‰å–®å­—è³‡æ–™ï¼Œè«‹æª¢æŸ¥ data.jsï¼`);
                 return;
            }

            // æ¸²æŸ“åˆ†é¡æŒ‰éˆ•
            renderCategoryButtons(categories);

            // åˆ‡æ›ç•«é¢
            document.getElementById('screen-grade').style.display = 'none';
            document.getElementById('screen-cards').style.display = 'flex';
            document.getElementById('grade-info').innerText = `Grade ${grade}`;

            // é è¨­ç¯©é¸ ALL
            filterCards('ALL');
        }

        // Step 2 è¼”åŠ©ï¼šæ¸²æŸ“åˆ†é¡æŒ‰éˆ•
        function renderCategoryButtons(categories) {
            const bar = document.getElementById('category-bar');
            bar.innerHTML = '';
            
            // 1. å…¨éƒ¨æŒ‰éˆ•
            bar.appendChild(createFilterBtn('ALL', 'å…¨éƒ¨', 'ğŸ”¥', 'indigo'));

            // 2. å…¶ä»–åˆ†é¡æŒ‰éˆ•
            categories.forEach(cat => {
                const config = CAT_CONFIG[cat] || CAT_CONFIG['default'];
                bar.appendChild(createFilterBtn(cat, config.cn, config.icon, config.color));
            });
        }

        // è¼”åŠ©ï¼šå»ºç«‹å–®å€‹åˆ†é¡æŒ‰éˆ•
        function createFilterBtn(catKey, cnText, icon, color) {
            const btn = document.createElement('button');
            btn.className = `cat-btn px-4 py-1.5 rounded-full border border-gray-200 text-sm font-bold whitespace-nowrap transition`;
            btn.dataset.category = catKey;
            btn.innerHTML = `${icon} ${cnText}`;
            btn.onclick = () => filterCards(catKey);
            return btn;
        }

        // Step 3: ç¯©é¸å–®å­—ä¸¦æ¸²æŸ“
        function filterCards(category) {
            currentCategory = category;

            // 1. å–å¾—è©²å¹´ç´šæ‰€æœ‰å–®å­—
            let filteredData = window.VOCAB_LIST.filter(item => item.grade === currentGrade);

            // 2. ä¾åˆ†é¡ç¯©é¸
            if (category !== 'ALL') {
                filteredData = filteredData.filter(item => item.cat === category);
            }

            // 3. æ¸²æŸ“
            renderCards(filteredData);
            
            // 4. æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });
        }

        // æ ¸å¿ƒï¼šæ¸²æŸ“å¡ç‰‡ HTML
        function renderCards(data) {
            const container = document.getElementById('cards-container');
            if (!container) return;
            
            container.innerHTML = ''; 

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'vocab-card bg-white rounded-2xl p-6 flex flex-col items-center justify-center relative overflow-hidden shadow-md';
                
                // é»æ“Šç™¼éŸ³
                card.onclick = () => speak(item.word);

                card.innerHTML = `
                    <div class="absolute top-3 right-3 text-gray-300 hover:text-primary transition">
                        <i class="fas fa-volume-up"></i>
                    </div>
                    <div class="text-6xl mb-4 filter drop-shadow-sm transform transition-transform group-hover:scale-110">${item.icon}</div>
                    <div class="text-2xl font-game font-bold text-gray-800 tracking-wide mb-1">${item.word}</div>
                    <div class="text-sm text-gray-500 font-bold bg-gray-100 px-3 py-1 rounded-full">${item.cn}</div>
                `;
                container.appendChild(card);
            });

             if (data.length === 0) {
                 container.innerHTML = '<p class="text-center text-gray-500 mt-10">é€™å€‹åˆ†é¡ç›®å‰æ²’æœ‰å–®å­—ã€‚</p>';
             }
        }

        // èªéŸ³ç™¼éŸ³
        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text.toLowerCase());
                u.lang = 'en-US';
                u.rate = 0.8;
                
                // ç¢ºä¿èªéŸ³è¼‰å…¥
                const voices = window.speechSynthesis.getVoices();
                const preferredVoice = voices.find(v => v.name.includes("Google US English")) || voices.find(v => v.name.includes("Samantha"));
                if (preferredVoice) u.voice = preferredVoice;

                window.speechSynthesis.speak(u);
            }
        }

        // Step 1: é¡¯ç¤ºå¹´ç´šé¸æ“‡ (ç”¨æ–¼ Home é é¢æŒ‰éˆ•)
        function showGradeSelect() {
            document.getElementById('screen-grade').style.display = 'flex';
            document.getElementById('screen-cards').style.display = 'none';
        }
    </script>
</body>
</html>
